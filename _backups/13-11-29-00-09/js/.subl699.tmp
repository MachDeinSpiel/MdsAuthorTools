var onResizeListener = [],
	onLoadListener = [],
	canvas,
	statesWrapper,
	workspace,
	sideToolBar,
	fsmTools,
	popUp,
	popUpContent,
	stateManager,
	dragData;

function findDomElements(){
	canvas = document.getElementById('canvas');
	statesWrapper = document.getElementById('states');
	workspace = document.getElementById('workspace');
	sideToolBar = document.getElementById('side-tool-bar');
	fsmTools = document.getElementById('fsm-tool');		
	popUp = document.getElementById('workspace-popup');
	popUpContent = document.getElementById('workspace-popup-content');
	stateManager = new StateManager();
	
}
registerOnLoadListener(findDomElements);
function resizeCanvas() {
	
		// canvas
	canvas.width = window.innerWidth-50-5;
	canvas.height = window.innerHeight-50-5;
		// states
	statesWrapper.style.width = window.innerWidth-50-5 + 'px';
	statesWrapper.style.height = window.innerHeight-50.5 + 'px';	
	workspace.style.width = window.innerWidth-50-5 + 'px';
	workspace.style.height = window.innerHeight-50.5 + 'px';
	sideToolBar.style.height = fsmTools.style.height = window.innerHeight-50 + 'px';
		// Popup
	popUp.style.width = window.innerWidth-50-5 + 'px';
	popUp.style.height = window.innerHeight-50.5 + 'px';

	popUp.onclick = function(event){
		//popUp.style.display = "none";
	}

	popUpContent.onclick = function(event){
		// console.log("bla");
		//event nicht weiterreichen.
		//event.stopPropagation();
	}
}


function registerOnLoadListener(listener){
	onLoadListener.push(listener);
}


function registerOnResizeListener(listener){
	onResizeListener.push(listener);
}

window.onload =  function(){
	onLoadListener.forEach(function(listener){
		listener();
	});
}
window.onresize =  function(){
	onResizeListener.forEach(function(listener){
		listener();
	});
}

registerOnLoadListener(resizeCanvas);
registerOnResizeListener(resizeCanvas);


/**
 * Aussehen des LayoutJSON:
 * 	{
 * 		preset: "none"
 *		title: "title",
 *		subtitle: "subtitle",
 *		fields: [
 *					{
 *						name: "name",
 *						type: "number"/"string"/"location"/"date"
 *					}
 *				]
 * 	}
 *
 * 	oder als preset:
 *
 * 	{
 *		preset: "state"
 * 	}
 *
 * 	bzw
 *
 * 	{
 *		preset: "link"
 * 	}
 *
 */
function showPopUp(layoutJSON, callback){	
	if(typeof(callback) !== 'function'){
		// console.error("[showPopUp]callback is no function!")
		return;
	}
	var popupWidth = 500;
	var popupHeight = 600;
	var layout = JSON.parse(layoutJSON);
	// console.log(layout.preset);
	var closeButton = document.getElementById('workspace-popup-close-button');
	closeButton.onclick = function(e){
		closePopUp();
	}
	if(layout.preset === 'state'){
		var submitButton = document.getElementById('workspace-popup-save-button');
		var nameField = document.getElementById('workspace-popup-content-newstate-input-title');
		var inActions = document.getElementById('workspace-popup-content-newstate-inaction-action-wrapper');
		var outActions = document.getElementById('workspace-popup-content-newstate-outaction-action-wrapper');
		var inActionContainer = document.getElementById('workspace-popup-content-newstate-inaction-container');
		var outActionContainer = document.getElementById('workspace-popup-content-newstate-outaction-container');
		var newInActionButton = document.getElementById('workspace-popup-content-newstate-inaction-action-new-button');
		var newOutActionButton = document.getElementById('workspace-popup-content-newstate-outaction-action-new-button');
		var newInActionType = document.getElementById('workspace-popup-content-newstate-inaction-action-new-type');
		var newOutActionType = document.getElementById('workspace-popup-content-newstate-outaction-action-new-type');
		console.log(inActionContainer);

		nameField.onclick = function(e){
			this.style.border = 'none';
		}


		newInActionButton.onclick = function(e){
			console.log(inActionContainer);
			console.log(inActionContainer.offsetHight);
			console.log(outActionContainer.style.height);
			var newActi